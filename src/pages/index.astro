---
import Layout from "../layouts/Layout.astro";
import "../styles/index.css";
---

<Layout title="Wilbur's Site" description="About me, my interests, and random other stuff">
    <br>
    <h1 class="centretext mainheader">Wilbur's Website</h1>
    <span class="splash" id="splash"></span>
    <br><br>
    <br>
    <p class="mobileonly">
        Small screen support still in beta, please report any issues to me
    </p>
    <p class="centretext">
        <a class="abutp" id="musiccontrol">*Click here to play music!*</a>
        <br>
        <button id="prevTrack">Previous</button>
        <button id="nextTrack">Next</button>
        <br>
        <sub><a href="https://music.eyescary.uk">ESMusic</a></sub>
    </p>
    <audio id="audioPlayer" preload="auto"></audio>
    <div class="section maindivdiv">
        <div>
            <h2>Webrings</h2>
            <b><a class="abutp" href="https://webring.dinhe.net/">Retronaut webring</a></b>
            <p>
                <a href="https://webring.dinhe.net/prev/https://wilburwilliams.uk">Previous</a> |
                <a href="https://webring.dinhe.net/next/https://wilburwilliams.uk">Next</a>
            </p>
            <h2>My time</h2>
            <p id="mytime"></p>
        </div>
        <div>
            <h2>About</h2>
            <p>
                Hello, I'm Wilbur<sub id="pronouns">(he/they)</sub>. I'm a personâ„¢ that enjoys most things
                computer-related, plus trains and electrical engineering. You'll
                often find me working on <a href="/projects">projects</a> listed here,
                usually on <a href="/domains">domains</a> I've set up.
            </p>
            <p>
                I'm a systems administrator at <a href="https://allthingslinux.org">All Things Linux</a>,
                and I lead the <a href="https://iso.atl.dev">ISO Archive</a> project.
            </p>
            <p>
                Feel free to have a look around this site to explore from the
                <a href="HTML2/wilbur/manipulator.html">downright stupid</a> to the
                <a href="newtab/">actually kinda cool</a>.
            </p>
            <p>
                My hyperfixations (interests) include computing (especially
                <a href="https://allthingslinux.org">Linux</a>,
                <a href="https://iso.atl.dev">archiving</a>,
                <a href="/mirrors/">content delivery / mirroring</a>, networking, and BGP),
                electronics, software engineerings, cryptotechnology,
                and <span title="type 'trains'">trains.</span>
            </p>
            <p>
                I enjoy programming, researching random stuff (I spend too much
                time on Wikipedia), working on various <a href="/projects">projects</a>,
                watching YT, and playing games (I have over 3000 days in one Minecraft world).
            </p>
            <span id="icons">
                <span id="icons-left">
                    <img src="https://assets.c48.uk/spinny_cat/spinny_cat_aroace.gif">
                    <img src="https://assets.c48.uk/spinny_cat/spinny_cat_ace.gif">
                    <img src="https://assets.c48.uk/spinny_cat/spinny_cat_aro.gif">
                    <img title="autistic" src="/images/neurodiversity.png">
                </span>
                <span id="icons-right">
                    <a href="https://github.com/ThisCatLikesCrypto"><img src="/images/github.png"></a>
                    <a href="https://discord.com/users/719947906492268645"><img title="(thiscatlikescrypto)"
                            src="/images/discord.png"></a>
                    <a rel="me" href="https://wetdry.world/@wilbur"><img src="/images/mastodon.png"></a>
                </span>
            </span>
        </div>
        <div>
            <h2>Other</h2>
            <p>(pages that aren't on the sidebar or anywhere else)</p>
            <a href="3dsite/">3D site</a><br>
            <a href="test.html">test thing from ages ago</a><br>
            <a href="publickey.html">public key</a>
        </div>
    </div>
    <br>
    <div class="section equaldivdiv">
        <div class="buttons">
            <h2 class="centretext">Buttons</h2>
            <div class="centretext">
                <abbr title="Button, click to copy">
                    <a onclick="copyBtnEmbed()">
                        <img alt="website button" loading="eager" src="assets/button.gif">
                    </a>
                </abbr>
                <a href="https://vivwebz.net/home" target="_blank">
                    <img loading="eager" src="images/buttons/viv.png" alt="vivwebz">
                </a>
                <a href="https://pittab.neocities.org" target="_blank">
                    <img loading="eager" src="images/buttons/pittab.png" alt="pitt ab (not a real company)">
                </a>
                <a href="https://jasperweb.uk/" target="_blank">
                    <img loading="eager" src="images/buttons/jasper.webp" alt="chaos">
                </a>
                <a href="https://accuratelinuxgraphs.com">
                    <img loading="eager" src="images/buttons/accuratelinuxgraphs.png" alt="accuratelinuxgraphs">
                </a>
                <a href="https://eightyeightthirty.one">
                    <img loading="eager" src="images/buttons/eightyeightthirtyone.png" alt="88x31">
                </a>
                <a href="https://kalechips.net/responsive">
                    <img loading="eager" src="images/buttons/responsive.png" alt="responsive web design">
                </a>
                <a href="https://split.pet">
                    <img loading="eager" src="https://split.pet/88x31/split.png" alt="split.pet">
                </a>
                <a href="https://fluoritebyte.neocities.org">
                    <img loading="eager" src="https://fluoritebyte.neocities.org/88x31.png" alt="fluoritebyte"
                        title="fluoritebyte">
                </a>
                <a href="https://bomberfish.ca/?higherdimension">
                    <img loading="eager" src="images/buttons/bomberfish.gif" alt="BomberFish" title="BomberFish">
                </a>
            </div>
        </div>
        <div>
            <h2 class="centretext">Status</h2>
            <h3>
                <table id="statusTable" style="margin: 0 auto;">
                    <thead>
                        <tr>

                        </tr>
                    </thead>
                    <tbody>
                        <!-- Status rows will be injected here -->
                    </tbody>
                </table>
            </h3>
        </div>
    </div>
    <br>
    </Layout>

<script>
    // --- Music Player Code ---
    const songList = [
        "/assets/scatteredcells.opus",
        "https://eyescary-development.github.io/CDN/musik/ESDP2/BHP_IS_A_ONE_CENT_STOCK_FRAUD.mp3",
        "https://eyescary-development.github.io/CDN/musik/DRUMNBASS/DRUMNBASS1.mp3",
    ];

    function shuffleArray(array) {
        let currentIndex = array.length,
            temporaryValue,
            randomIndex;
        while (currentIndex !== 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            temporaryValue = array[currentIndex];
            array[currentIndex] = array[randomIndex];
            array[randomIndex] = temporaryValue;
        }
        return array;
    }

    let shuffledSongs = shuffleArray([...songList]);
    let currentTrack = 0;
    const audio = document.getElementById("audioPlayer") as HTMLAudioElement;

    function loadTrack(index) {
        if (index < 0 || index >= shuffledSongs.length) return;
        audio.src = shuffledSongs[index];
    }

    loadTrack(currentTrack);
    let isPlaying = false;

    function togglePlay() {
        if (isPlaying) {
            audio.pause();
            isPlaying = false;
            document.getElementById("musiccontrol").innerHTML =
                "Click to resume music";
        } else {
            audio.play();
            isPlaying = true;
            document.getElementById("musiccontrol").innerHTML =
                "Click to pause music";
        }
    }

    function nextTrack() {
        currentTrack = (currentTrack + 1) % shuffledSongs.length;
        loadTrack(currentTrack);
        if (isPlaying) {
            audio.play();
        }
    }

    function prevTrack() {
        currentTrack =
            (currentTrack - 1 + shuffledSongs.length) % shuffledSongs.length;
        loadTrack(currentTrack);
        if (isPlaying) {
            audio.play();
        }
    }
    
    audio.addEventListener("ended", function () {
        nextTrack();
    });

    const splashtext = [
        "Why does this exist again",
        "prefers-reduced-motion: no movement",
        "hmmm, what to put here?",
        "defying gravity",
        "HTML2 is just an archive",
        "Wine Is Not an Emulator",
        "built with VSCode",
        "<a href='https://www.youtube.com/watch?v=M93mt3NzkmM'>This song has no right being this good</a>",
        "<a href='https://www.youtube.com/watch?v=24sx3aFynQI'>1996 stock motors</a>",
        "<img style='height: 32px; width: 32px;' src='https://assets.c48.uk/spinny_cat/spinny_cat_ace.gif' alt='spinny_cat_ace'>",
        "<img style='height: 32px; width: 32px;' src='https://assets.c48.uk/spinny_cat/spinny_cat_aroace.gif' alt='spinny_cat_aroace'>",
        "<img style='height: 32px; width: 32px;' src='https://assets.c48.uk/spinny_cat/spinny_cat_aro.gif' alt='spinny_cat_aro'>",
        "<a href='https://www.youtube.com/watch?v=83CqPViJB0I'>UNIFY</a>",
        "Killer Queen"
    ];

    function choose(choices) {
        return choices[Math.floor(Math.random() * choices.length)];
    }

    function getUKTime() {
        const now = new Date();
        const ukTimeFormatter = new Intl.DateTimeFormat("en-GB", {
            timeZone: "Europe/London",
            hour: "2-digit",
            minute: "2-digit",
            second: "2-digit",
        });
        return ukTimeFormatter.format(now);
    }

    // --- Event Listeners ---
    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("musiccontrol").onclick = togglePlay;
        document.getElementById("prevTrack").onclick = prevTrack;
        document.getElementById("nextTrack").onclick = nextTrack;
        document.getElementById("splash").innerHTML = choose(splashtext);
        document.getElementById("mytime").innerHTML = getUKTime();
    });

    setInterval(function () {
        document.getElementById("mytime").innerHTML = getUKTime();
    }, 1000);

    async function displayStatus(response) {
        const statusTableBody = document.querySelector("#statusTable tbody");
        const URLtoname = {
            "https://wilburwilliams.uk": "site",
            "https://repo.c48.uk": "mirror",
            "https://de.repo.c48.uk": "german mirror",
            "https://uk.repo.c48.uk": "uk mirror",
            "https://assets.c48.uk": "assets",
        };
        const data = await response.json();
        const entries = Object.entries(data);
        for (let i = 0; i < entries.length; i += 2) {
            const row = document.createElement("tr");
            for (let j = 0; j < 2; j++) {
                const idx = i + j;
                if (idx < entries.length) {
                    const [key, value] = entries[idx];
                    const statusCode = Number(value);
                    const nameCell = document.createElement("td");
                    nameCell.textContent = URLtoname[key];
                    const statusCell = document.createElement("td");
                    statusCell.id = URLtoname[key];
                    statusCell.textContent = String(value);
                    if (statusCode >= 200 && statusCode < 300) {
                        statusCell.style.color = "limegreen";
                    } else if (statusCode >= 300 && statusCode < 400) {
                        statusCell.style.color = "orange";
                    } else {
                        statusCell.style.color = "red";
                    }
                    row.appendChild(nameCell);
                    row.appendChild(statusCell);
                } else {
                    // Fill empty cells if not enough entries for the last row
                    row.appendChild(document.createElement("td"));
                    row.appendChild(document.createElement("td"));
                }
            }
            statusTableBody.appendChild(row);
        }
    }

    async function fetchStatus() {
        const url = "https://oxfbw5zjg2kikumhitruzci2gi0bmugx.lambda-url.eu-west-2.on.aws/";
        try {
            const response = await fetch(url);
            displayStatus(response);
        } catch (error) {
            console.warn("status lambda failed, it does this a lot so will be retried after a 3 second delay");
            await sleep(3000);
            try {
                const response = await fetch(url);
                displayStatus(response);
            } catch (error) {
                console.warn("status lambda failed, it does this a lot so will be retried after a 3 second delay (2)");
                await sleep(3000);
                try {
                    const response = await fetch(url);
                    displayStatus(response);
                } catch (error) {
                    console.error(
                        "There was a problem with the fetch operation:",
                        error,
                    );
                }
        }
        }
    }
    fetchStatus();
</script>
